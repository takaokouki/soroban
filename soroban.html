<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四桁のそろばん</title>
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }
        #display {
            font-size: 2em;
            margin-bottom: 20px;
        }
        .soroban {
            display: flex;
            justify-content: center;
            padding: 20px;
            background-color: #a9a9a9;
        }
        .column {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 50px;
            position: relative;
            margin: 0 10px;
        }
        .upper, .lower {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .bead {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            background-color: darkgray;
            border: 2px solid black;
        }
        .rod {
            width: 10px;
            height: 97%;
            background-color: brown;
            position: absolute;
            top: 5px;
        }
        .divider {
            width: 70px;
            height: 10px;
            background-color: black;
            margin: 20px 0;
            z-index: 900;
        }
    </style>
</head>
<body>
    <div id="display">0</div>
    <div class="soroban" id="soroban"></div>

    <script>
        const soroban = document.getElementById("soroban");
        const display = document.getElementById("display");
        let values = [0, 0, 0, 0];

        // 各値に対応する色マッピング
        const colorMap = {
            1: "black",
            2: "red",
            3: "gold",
            4: "green",
            5: "orange",
            6: "white",
            7: "navy",
            8: "maroon",
            9: "saddlebrown"
        };

        function createColumn(index) {
            const column = document.createElement("div");
            column.classList.add("column");

            const rod = document.createElement("div");
            rod.classList.add("rod");
            column.appendChild(rod);

            const upper = document.createElement("div");
            upper.classList.add("upper");
            const upperBead = document.createElement("div");
            upperBead.classList.add("bead");
            upperBead.addEventListener("click", () => toggleUpperBead(index, upperBead));
            upper.appendChild(upperBead);
            column.appendChild(upper);

            const divider = document.createElement("div");
            divider.classList.add("divider");
            column.appendChild(divider);

            const lower = document.createElement("div");
            lower.classList.add("lower");
            const lowerBeads = [];
            for (let i = 0; i < 4; i++) {
                const lowerBead = document.createElement("div");
                lowerBead.classList.add("bead");
                lowerBead.addEventListener("click", () => toggleLowerBeads(index, i + 1, lowerBeads));
                lowerBeads.push(lowerBead);
                lower.appendChild(lowerBead);
            }
            column.appendChild(lower);

            soroban.appendChild(column);
        }

        function toggleUpperBead(index, bead) {
            values[index] = values[index] >= 5 ? values[index] - 5 : values[index] + 5;
            bead.style.transform = values[index] >= 5 ? "translateY(20px)" : "translateY(0px)";
            updateBeadColors(index);
            updateDisplay();
        }

        function toggleLowerBeads(index, newValue, lowerBeads) {
            if (values[index] % 5 >= newValue) {
                values[index] -= (values[index] % 5) - (newValue - 1);
            } else {
                values[index] = Math.floor(values[index] / 5) * 5 + newValue;
            }
            lowerBeads.forEach((b, j) => {
                b.style.transform = j < values[index] % 5 ? "translateY(-20px)" : "translateY(0px)";
            });
            updateBeadColors(index);
            updateDisplay();
        }

        function updateBeadColors(index) {
            const columns = document.querySelectorAll(".column");
            const upperBead = columns[index].querySelector(".upper .bead");
            const lowerBeads = columns[index].querySelectorAll(".lower .bead");
            
            upperBead.style.backgroundColor = values[index] >= 5 ? colorMap[values[index]] || "darkgray" : "darkgray";
            lowerBeads.forEach((bead, i) => {
                bead.style.backgroundColor = i < values[index] % 5 ? colorMap[values[index]] || "darkgray" : "darkgray";
            });
        }

        function updateDisplay() {
            display.textContent = parseInt(values.join(""), 10).toString();
        }

        for (let i = 0; i < 4; i++) {
            createColumn(i);
        }
    </script>
</body>
</html>
